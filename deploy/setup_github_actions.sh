#!/bin/bash
# Setup GitHub Actions deployment for BluecoinsWeb

echo "ðŸš€ Setting up GitHub Actions Auto-Deployment"
echo "=============================================="
echo ""

# Check if we're in the right directory
if [ ! -f "manage.py" ]; then
    echo "âŒ Error: This script must be run from the BluecoinsWeb root directory"
    echo "Current directory: $(pwd)"
    echo "Please run: cd /opt/bluecoins-web && ./deploy/setup_github_actions.sh"
    exit 1
fi

echo "âœ… GitHub Actions workflow file created at: .github/workflows/deploy.yml"
echo ""
echo "ðŸ“‹ Next steps to complete setup:"
echo ""
echo "1. Go to your GitHub repository: https://github.com/your-username/BluecoinsWeb"
echo ""
echo "2. Click: Settings â†’ Secrets and variables â†’ Actions"
echo ""
echo "3. Add these 3 repository secrets:"
echo "   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "   â”‚ Secret Name     â”‚ Value                                â”‚"
echo "   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤"
echo "   â”‚ AWS_HOST        â”‚ $(curl -s http://169.254.169.254/latest/meta-data/public-ipv4 2>/dev/null || echo "YOUR_EC2_PUBLIC_IP")"
echo "   â”‚ AWS_USERNAME    â”‚ $(whoami)                                     â”‚"
echo "   â”‚ AWS_SSH_KEY     â”‚ (Paste your private .pem key content)   â”‚"
echo "   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
echo "4. Commit and push the workflow file:"
echo "   git add .github/workflows/deploy.yml"
echo "   git commit -m \"Add GitHub Actions auto-deployment\""
echo "   git push origin main"
echo ""
echo "5. Test the deployment:"
echo "   - Make any small change to your code"
echo "   - git add ."
echo "   - git commit -m \"Test auto-deployment\""
echo "   - git push origin main"
echo "   - Check GitHub Actions tab to see the deployment in progress"
echo ""
echo "ðŸŽ‰ That's it! Every push to main will now auto-deploy to AWS."
echo ""
echo "ðŸ“Š Useful links:"
echo "  - View deployments: https://github.com/your-username/BluecoinsWeb/actions"
echo "  - Monitor logs: sudo journalctl -u bluecoins-web -f"
echo "  - Manual update: ./deploy/update.sh"
echo ""
